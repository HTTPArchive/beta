{% extends "main.html" %}


{% block title %}{{ super() }} | {{ report.name }} {{ "| " + date if date }}{% endblock %}

{% block main %}
	<h1>{{ report.name }}</h1>
	<button {% if date == report.dates[0] %}disabled{% endif %}>Most Recent</button>
	<select id="dates">
		{% for d in report.dates %}
			<option {% if d == date %}selected{% endif %}>{{ d }}</option>
		{% endfor %}
	</select>

	<h2>Table of Contents</h2>
	<ul id="TOC">
	{% for metric, options in report.metrics.items() %}
		<li>
			<a href="#{{ metric }}">{{ options.name }}</a>
			<ul>
				<li>
					<a href="#{{ metric }}-chart">Chart</a>
				</li>
				<li>
					<a href="#{{ metric }}-table-desktop">Desktop Table</a>
				</li>
				<li>
					<a href="#{{ metric }}-table-mobile">Mobile Table</a>
				</li>
			</ul>
		</li>
	{% endfor %}
	</ul>

	{% for metric, options in report.metrics.items() %}
		<section id="{{ metric }}">
			<h2>{{ options.name }}</h2>
			<div id="{{ metric }}-chart" class="chart"></div>
			<table id="{{ metric }}-table-desktop" class="table"></table>
			<table id="{{ metric }}-table-mobile" class="table"></table>
		</section>
	{% endfor %}

	<script src="https://code.highcharts.com/highcharts.js"></script>
	<script src="https://code.highcharts.com/modules/exporting.js"></script>
	<script src="/static/js/histogram.js"></script>
	<script>
const dates = document.getElementById('dates');
dates.addEventListener('change', e => {
	location.href = `?date=${e.target.value}`;
});
function histogram(metric, date, options) {
	const dataUrl = `/static/json/${date}/${metric}.json`;
	fetch(dataUrl)
		.then(response => response.text())
		.then(nljson => `[${nljson.replace(/\n/g, ',')}]`.replace(',]', ']'))
		.then(jsonStr => JSON.parse(jsonStr))
		.then(data => {
			drawHistogram(data, `${metric}-chart`);
			drawHistogramTable(data, `${metric}-table-desktop`, `${metric}-table-mobile`);
		});
}
{% for metric, options in report.metrics.items() %}
	histogram('{{ metric }}', '{{ date }}', {{ options|tojson }});
{% endfor %}
	</script>
{% endblock %}
